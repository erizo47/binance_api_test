import{b as $,m as V,o as U,g as E,E as z,a0 as G,a1 as J,a2 as H,a3 as K,a4 as _,a5 as Q,a6 as b,d as W,q as Y,s as Z,w as X,u as ee,c as l,a7 as te,K as w,a8 as ae,Z as j,a9 as L,M as c,N as se,O as h,Q as d,aa as u,S as m,ab as T,T as re,U as F,ac as oe,W as N,P as f,$ as ne}from"./index-821b5ecd.js";import{u as k,c as S,a as le}from"./VSelect-45336ee0.js";const x=["start","end","center"],I=["space-between","space-around","space-evenly"];function B(e,a){return J.reduce((t,o)=>{const s=e+H(o);return t[s]=a(),t},{})}const ie=[...x,"baseline","stretch"],P=e=>ie.includes(e),D=B("align",()=>({type:String,default:null,validator:P})),de=[...x,...I],A=e=>de.includes(e),R=B("justify",()=>({type:String,default:null,validator:A})),ue=[...x,...I,"stretch"],M=e=>ue.includes(e),q=B("alignContent",()=>({type:String,default:null,validator:M})),C={align:Object.keys(D),justify:Object.keys(R),alignContent:Object.keys(q)},ce={align:"align",justify:"justify",alignContent:"align-content"};function be(e,a,t){let o=ce[e];if(t!=null){if(a){const s=a.replace(e,"");o+=`-${s}`}return o+=`-${t}`,o.toLowerCase()}}const me=$({dense:Boolean,noGutters:Boolean,align:{type:String,default:null,validator:P},...D,justify:{type:String,default:null,validator:A},...R,alignContent:{type:String,default:null,validator:M},...q,...V(),...U()},"VRow"),fe=E()({name:"VRow",props:me(),setup(e,a){let{slots:t}=a;const o=z(()=>{const s=[];let n;for(n in C)C[n].forEach(i=>{const r=e[i],p=be(n,i,r);p&&s.push(p)});return s.push({"v-row--no-gutters":e.noGutters,"v-row--dense":e.dense,[`align-${e.align}`]:e.align,[`justify-${e.justify}`]:e.justify,[`align-content-${e.alignContent}`]:e.alignContent}),s});return()=>{var s;return G(e.tag,{class:["v-row",o.value,e.class],style:e.style},(s=t.default)==null?void 0:s.call(t))}}}),g=K("orderBookStore",{state:()=>({lastUpdateId:0,bids:{},asks:{},limitList:[100,500,1e3],limit:100}),getters:{resultedBids(){return Object.keys(this.bids).sort((e,a)=>Number(a)-Number(e)).slice(0,this.limit)},resultedAsks(){return Object.keys(this.asks).sort((e,a)=>Number(a)-Number(e)).slice(0,this.limit)}},actions:{async getOrderBook(){const e=k(),a=_();try{const{lastUpdateId:t,bids:o,asks:s}=await Q.get("/api/v3/depth",{params:{symbol:e.current,limit:this.limit}});this.lastUpdateId=t,o.forEach(n=>{this.bids[n[0]]=n[1]}),s.forEach(n=>{this.asks[n[0]]=n[1]}),await this.subscribeOrderBookStream()}catch{a.showSnackbar({text:"Failed to get order book data",color:"error"})}},async subscribeOrderBookStream(){const e=k(),a=_();try{b.send(JSON.stringify({method:"SUBSCRIBE",params:[`${e.current.toLowerCase()}@depth@1000ms`],id:1})),b.onmessage=t=>{const o=JSON.parse(t.data);o.e!=="depthUpdate"&&o.s!==e.current||o.u<=this.lastUpdateId||o.U<=this.lastUpdateId+1&&o.u>=this.lastUpdateId+1&&(this.lastUpdateId=o.u,o.b.forEach(s=>{if(Number(s[1])===0){delete this.bids[`${s[0]}`];return}this.bids[`${s[0]}`]=s[1]}),o.a.forEach(s=>{if(Number(s[1])===0){delete this.asks[`${s[0]}`];return}this.asks[`${s[0]}`]=s[1]}))},b.onerror=()=>{a.showSnackbar({text:"Failed to subscribe to order book stream",color:"error"})},b.onclose=()=>{a.showSnackbar({text:"Order book stream closed",color:"success"})}}catch(t){console.log("error",t),a.showSnackbar({text:"The error occurred while try to subscribe to order book stream",color:"error"})}},unsubscribeOrderBookStream(){const e=_(),a=k();b.send(JSON.stringify({method:"UNSUBSCRIBE",params:[`${a.current.toLowerCase()}`],id:312})),b.onmessage=t=>{const o=JSON.parse(t.data);o.result!==null&&o.id!==312||e.showSnackbar({text:"Unsubscribed from order book stream",color:"success"})}}}});const he=$({fixedHeader:Boolean,fixedFooter:Boolean,height:[Number,String],hover:Boolean,...V(),...W(),...U(),...Y()},"VTable"),ye=E()({name:"VTable",props:he(),setup(e,a){let{slots:t}=a;const{themeClasses:o}=Z(e),{densityClasses:s}=X(e);return ee(()=>l(e.tag,{class:["v-table",{"v-table--fixed-height":!!e.height,"v-table--fixed-header":e.fixedHeader,"v-table--fixed-footer":e.fixedFooter,"v-table--has-top":!!t.top,"v-table--has-bottom":!!t.bottom,"v-table--hover":e.hover},o.value,s.value,e.class],style:e.style},{default:()=>{var n,i,r;return[(n=t.top)==null?void 0:n.call(t),t.default?l("div",{class:"v-table__wrapper",style:{height:te(e.height)}},[l("table",null,[t.default()])]):(i=t.wrapper)==null?void 0:i.call(t),(r=t.bottom)==null?void 0:r.call(t)]}})),{}}}),O=w({__name:"OrderBookTable",props:{prices:{},tableType:{}},setup(e){const a=e,t=g(),o=k(),s=ae(!1),n=()=>{if(window.innerWidth<=658){s.value=!0;return}s.value=!1},i=r=>{switch(o.current){case"BTCUSDT":return{price:Number(r).toFixed(2),quantity:a.tableType==="bids"?Number(t.bids[r]).toFixed(3):Number(t.asks[r]).toFixed(3),total:(Number(r)*(a.tableType==="bids"?Number(t.bids[r]):Number(t.asks[r]))).toFixed(3)};case"BNBBTC":return{price:Number(r).toFixed(6),quantity:a.tableType==="bids"?Number(t.bids[r]).toFixed(3):Number(t.asks[r]).toFixed(3),total:(Number(r)*(a.tableType==="bids"?Number(t.bids[r]):Number(t.asks[r]))).toFixed(3)};case"ETHBTC":return{price:Number(r).toFixed(5),quantity:a.tableType==="bids"?Number(t.bids[r]).toFixed(4):Number(t.asks[r]).toFixed(4),total:(Number(r)*(a.tableType==="bids"?Number(t.bids[r]):Number(t.asks[r]))).toFixed(3)};default:return{price:r,quantity:a.tableType==="bids"?Number(t.bids[r]):Number(t.asks[r]),total:Number(r)*(a.tableType==="bids"?Number(t.bids[r]):Number(t.asks[r]))}}};return j(()=>{window.addEventListener("resize",n),n()}),L(()=>{window.removeEventListener("resize",n)}),(r,p)=>(c(),se(S,{class:u(`order_book-column ${s.value?"order_book-column--mobile":""}`),sm:"6",xs:"2"},{default:h(()=>[l(ye,{class:"table_wrap","fixed-header":""},{default:h(()=>[d("thead",null,[d("tr",null,[d("th",{class:u(`table_wrap ${s.value?"mobile-data-padding":""}`)}," Price ",2),s.value?T("",!0):(c(),m("th",{key:0,class:u(`table_wrap ${s.value?"mobile-data-padding":""}`)}," Quantity ",2)),d("th",{class:u(`table_wrap ${s.value?"mobile-data-padding":""}`)}," Total ",2)])]),d("tbody",{style:oe(`${s.value?"padding: 0 8px !important;":""}`)},[(c(!0),m(F,null,re(a.prices,y=>(c(),m("tr",{key:y},[d("td",{class:u(`${s.value?"mobile-data-padding":""} ${a.tableType==="bids"?"bid_text-color":"ask_text-color"}`)},N(i(y).price),3),s.value?T("",!0):(c(),m("td",{key:0,class:u(`${s.value?"mobile-data-padding":""}`)},N(i(y).quantity),3)),d("td",{class:u(`${s.value?"mobile-data-padding":""}`)},N(i(y).total),3)]))),128))],4)]),_:1})]),_:1},8,["class"]))}});const ke={class:"d-flex justify-space-between w-100"},ge=d("h2",null," Order Book ",-1),pe=w({__name:"OrderBookHeader",setup(e){const a=g();return(t,o)=>(c(),m("div",ke,[l(S,{class:"d-flex align-center pl-0",cols:"3"},{default:h(()=>[ge]),_:1}),l(S,{class:"pr-0",sm:"3",xs:"4"},{default:h(()=>[l(le,{modelValue:f(a).limit,"onUpdate:modelValue":o[0]||(o[0]=s=>f(a).limit=s),items:f(a).limitList,class:"pb-2",dense:"","hide-details":"",label:"Limit",rounded:"3",variant:"solo",width:"100"},null,8,["modelValue","items"])]),_:1})]))}}),v=()=>{const e=g();async function a(){await e.getOrderBook()}async function t(){e.unsubscribeOrderBookStream(),e.$reset()}return{fetchOrderBookData:a,resetOrderBookData:t}},ve=w({__name:"index",setup(e){const a=g();return j(()=>{v().fetchOrderBookData()}),L(()=>{v().resetOrderBookData()}),ne(()=>a.limit,()=>{v().fetchOrderBookData()}),(t,o)=>(c(),m(F,null,[l(pe),l(fe,{class:"d-flex flex-row"},{default:h(()=>[l(O,{prices:f(a).resultedBids,"table-type":"bids"},null,8,["prices"]),l(O,{prices:f(a).resultedAsks,"table-type":"asks"},null,8,["prices"])]),_:1})],64))}});export{ve as default};
